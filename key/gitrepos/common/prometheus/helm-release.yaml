apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: prometheus
  namespace: kube-system
spec:
  # Prometheus Community Helm chart
  repo: https://prometheus-community.github.io/helm-charts
  chart: kube-prometheus-stack
  version: 65.8.1
  targetNamespace: prometheus-monitoring
  createNamespace: true
  valuesContent: |-
    # Prometheus configuration
    prometheus:
      prometheusSpec:
        retention: 7d
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        # Disable persistence - no storage provisioner on downstream cluster
        storageSpec: {}

    # Grafana configuration
    grafana:
      enabled: true
      adminPassword: "admin"
      resources:
        requests:
          memory: "128Mi"
          cpu: "50m"
        limits:
          memory: "256Mi"
          cpu: "250m"
      # Disable persistence - no storage provisioner on downstream cluster
      persistence:
        enabled: false

    # AlertManager configuration
    alertmanager:
      enabled: true
      alertmanagerSpec:
        resources:
          requests:
            memory: "128Mi"
            cpu: "50m"
          limits:
            memory: "256Mi"
            cpu: "100m"
        # Disable persistence - no storage provisioner on downstream cluster
        storage: {}

    # Node Exporter - exports node metrics
    nodeExporter:
      enabled: true

    # Kube State Metrics - exports k8s object metrics
    kubeStateMetrics:
      enabled: true

    # Service monitors for automatic scraping
    kubeApiServer:
      enabled: true
    kubelet:
      enabled: true
    kubeControllerManager:
      enabled: true
    coreDns:
      enabled: true
    kubeEtcd:
      enabled: true
    kubeScheduler:
      enabled: true
    kubeProxy:
      enabled: true
